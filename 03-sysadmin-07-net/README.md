# Домашнее задание к занятию "3.7. Компьютерные сети, лекция 2"

1. На лекции мы обсудили, что манипулировать размером окна необходимо для эффективного наполнения приемного буфера участников TCP сессии (Flow Control). Подобная проблема в полной мере возникает в сетях с высоким RTT. Например, если вы захотите передать 500 Гб бэкап из региона Юга-Восточной Азии на Восточное побережье США. [Здесь](https://www.cloudping.co/grid) вы можете увидеть и 200 и 400 мс вполне реального RTT. Подсчитайте, какого размера нужно окно TCP чтобы наполнить 1 Гбит/с канал при 300 мс RTT (берем простую ситуацию без потери пакетов). Можно воспользоваться готовым [калькулятором](https://www.switch.ch/network/tools/tcp_throughput/). Ознакомиться с [формулами](https://en.wikipedia.org/wiki/TCP_tuning), по которым работает калькулятор можно, например, на Wiki.

    >Чтобы заполнить 1 Гбит/с канал при 300 мс RTT нужно окно TCP размером 37 500 000 (байт).

    >Размер окна в битах = Полоса пропускания (бит/сек) * RTT (время пинга).

    >10 * 10^8 (бит/с) * 0.3 (с) = 300 000 000 (бит)

    >300 000 000 (бит) / 8 = 37 500 000 (байт)

1. Во сколько раз упадет пропускная способность канала, если будет 1% потерь пакетов при передаче?
   > Предел пропускной способности канала можно рассчитать по формуле Mathis:

        пропускная способность канала = MSS/(RTT*sqrt(Ploss))

    >В нашем случае: MSS = 1460 байт, RTT = 300 мс, Ploss = 1%
    
    >пропускная способность канала = 11680 бит / (0.3 с * sqrt(0.01)) = 11680 бит/с 0.03 = 389 333 бит/с ≈ 0.39  Мбит/с

    >Таким образом, пропускная способность канала упала в 2564 раза , так как была 1000 Мбит/с а стала 0.39  Мбит/с


1. Какая  максимальная реальная скорость передачи данных достижима при линке 100 Мбит/с? Вопрос про TCP payload, то есть цифры, которые вы реально увидите в операционной системе в тестах или в браузере при скачивании файлов. Повлияет ли размер фрейма на это?

	>Максимальная реальная скорость передачи данных при линке 100 Мбит/с составляет 12,5 Мбайт (100 / 8)

	> Если мы хотим посчитать скорость передачи самих чистых данных, то стоит учитывать и размер заголовка TCP-сегмента. Заголовок Ethernet TCP-сегмента имеет размер 40 байт. Фрейм стандартно имеет размер 1500 байт. Полезной информации в фрейме, которую непосредственно нам надо передать, остается 1460 байт. Выходит, что заголовок составляет 2,67% от фрейма. Раз мы передаем полезных данных на 2,67% меньше, то можно от пропускной способности отнять эти 2,67%. Тогда максимальная реальная скорость передачи данных при линке 100 Мбит/с составит 12,17 Мбайт

1. Что на самом деле происходит, когда вы открываете сайт? :)
На прошлой лекции был приведен сокращенный вариант ответа на этот вопрос. Теперь вы знаете намного больше, в частности про IP адресацию, DNS и т.д.
Опишите максимально подробно насколько вы это можете сделать, что происходит, когда вы делаете запрос `curl -I http://netology.ru` с вашей рабочей станции. Предположим, что arp кеш очищен, в локальном DNS нет закешированных записей.

    > Вы вводите адрес в строку браузера, и теперь ему нужно перевести адрес из букв в цифры — IP-адрес.
Перед тем как отправить запрос на DNS-сервер, браузер заглянет в файл hosts — там написаны основные правила для всего компьютера.
Если там прописана наша соцсеть и IP-адрес, куда нужно отправлять запросы для этой соцсети, то браузер сразу будет отправлять запросы туда.

    > Веб-браузер хочет открыть сайт.

	Что происходит между уровнями:
	Веб-браузер на уровне формирует свой пакет данных (в нем запрос к веб-серверу http://netology.ru). Операционная система передает эти данные на уровень `Application`, для этого добавляя к пакету данных заголовок applicaion header. Далее данные передаются на уровень `Transport`, где к пакету с данными приложения добавляется transport header(Source Port, Destination port и другие данные). Этот сформированный TCP-сегмент(или UDP-датаграмма) передается на уровень `Network`, к нему добавляется network header, который содержит IP адрес отправителя, IP адрес получателя... Далее IP-пакет переходит на `Network Access` уровень(здесь данные передаются между узлами внутри сети на физическом уровне), где к пакету добавляется dataLink header(в нем содержатся Destination MAC Address и Source MAC Address, также на этом уровне по маске подсети определяется, входит ли вообще получатель в нашу локальную сеть, a Destination MAC Address определяется через arp-запрос) и datalink trailer. Этот фрейм уже непосредственно передается пакета другому устройству.

	> Когда запрос достиг сервера, Ethernet frame декапсулируется, распаковывается на каждом уровне. Сервер понимает, что мак адрес указан его, верный, убирает Ethernet header и Ethernet trailer и спускает получившийся ip-пакет на уровень Network, где используется IP протокол. Используя IP протокол, сервер понимает, что IP адрес получателя в этом пакете указан его, то есть верный. Поэтому убирает из пакета network header (в нашем влучае IP header). На уровне Transport TCP протокол понимает, что порт, обозначенный в TCP header верный, поэтому убирает TCP заголовок. Через слушающий порт к приложению приходит уже сам запрос, полезные данные, которые нужно было доставить до приложения.
	
	Что происходит на втором(Ethernet) и третьем(IP) уровне:
	> На третьем уровне - уровне IP, клиент проверяет, входит ли IP адрес получателя в локальную сеть. В нашем случае - не входит. Тогда клиент делает arp-запрос с мак-адресом роутера(шлюза по умолчанию). Далее отправляется Ethernet фрейм на роутер. Роутер убирает заголовки 2 и 3 уровня и добирается до данных IP заголовка. Далее роутер смотрит, есть ли в его таблице маршрутизации IP адрес получателя. Его там в нашем случае нет. Отправляется arp-запрос с уточнением, какому MAC адресу принадлежит IP адрес получателя. Сервер отвечает, какой у него MAC-адрес. Роутер в своей arp-таблицу сопоставляет наши IP-адрес и MAC-адрес получателя. Далее роутер запаковывает IP-пакет с данными клиента в Ethernet frame, меня MAC отправителя с клиентского на свой.
	
	Что происходит на транспортном(TCP) уровне:
	 > На транспортном уровне устанавливается TCP-соединение. Клиент отправляет пакет с флагом SYN. Сервер отправлят клиенту пакет с флагами SYN и ACK. Клиент отправляет серверу пакет с флагом ACK. Соединение установлено. Также сервер и клиент установили размер MSS. В этот момент происходит обмен полезными данными.
	 
	 > От сервера приходит ответ на запрос с клиентом (который содержит код необходимого сайта). Точно в той же последовательности, в которой происходил запрос от клиента.
	> Далее происходит закрытие соединения.

1. Сколько и каких итеративных запросов будет сделано при резолве домена `www.google.co.uk`?

1. Сколько доступно для назначения хостам адресов в подсети `/25`? А в подсети с маской `255.248.0.0`. Постарайтесь потренироваться в ручных вычислениях чтобы немного набить руку, не пользоваться калькулятором сразу.

    > В подсети `/25` доступно 128 адресов. За вычетом зарезервированных адресов (адреса подсети, адреса для широковещательных сообщений), адреса нашего хоста, адреса шлюза, остается 124 адреса, которые можно назначать другим хостам. 

    >Если подсеть `255.248.0.0` перевести в двоичное число, получится `11111111.11111000.00000000.00000000`. Это маска `/13` (так как 13 единиц в сетевой части маски). В этой маске доступно 2^19 адресов (так как 19 нулей в хостовой части маски), то есть доступно 524288 адресов.
1. В какой подсети больше адресов, в `/23` или `/24`?

    >Адресов больше в маске подсети `/23`. В подсети `/23` - 512 адресов, а в подсети `/24` - 256 адресов.

1. Получится ли разделить диапазон `10.0.0.0/8` на 128 подсетей по 131070 адресов в каждой? Какая маска будет у таких подсетей?

    > В маске `/8` всего есть 16 777 216 адресов. Данное количество адресов получится разделить на 128 подсетей по 131070 в каждой, так как 128 * 131070 = 16 776 960

    >Маска данных подсетей будет `/8` или 255.0.0.0.
