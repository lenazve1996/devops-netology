# Домашнее задание к занятию "3.6. Компьютерные сети, лекция 1"

1. Необязательное задание:
можно посмотреть целый фильм в консоли `telnet towel.blinkenlights.nl` :)

	>Done

1. Узнайте о том, сколько действительно независимых (не пересекающихся) каналов есть в разделяемой среде WiFi при работе на 2.4 ГГц. Стандарты с полосой 5 ГГц более актуальны, но регламенты на 5 ГГц существенно различаются в разных странах, а так же не раз обновлялись. В качестве дополнительного вопроса вне зачета, попробуйте найти актуальный ответ и на этот вопрос.

	> Независимыми или непересекающимися при работе на 2.4 ГГц являются только три канала: 1-й, 6-й и 11-й.

1. Адрес канального уровня – MAC адрес – это 6 байт, первые 3 из которых называются OUI – Organizationally Unique Identifier или уникальный идентификатор организации. Какому производителю принадлежит MAC `38:f9:d3:55:55:79`?

	>Apple, Inc

1. Каким будет payload TCP сегмента, если Ethernet MTU задан в 9001 байт, размер заголовков IPv4 – 20 байт, а TCP – 32 байта?

	>payload TCP segment = TCM MSS
TCM MSS = (IP MTU – [IPHDR + TCPHDR])
payload TCP segment = 9001 - (20 + 32) = 8949 байт
Ответ: 8949 байт

	>Что читала на эту тему:
	https://zvondozvon.ru/tehnologii/protokoli/tcp
	https://habr.com/ru/post/226807/
	https://www.ibm.com/support/knowledgecenter/ru/ssw_aix_71/performance/tcp_max_seg_size_tuning.html

1. Может ли во флагах TCP одновременно быть установлены флаги SYN и FIN при штатном режиме работы сети? Почему да или нет?

	>SYN предназначен для установления соединения через синхронизацию номера последовательности, а FIN для того, чтобы сообщить об окончании передачи данных
	одной из сторон. Несмотря на то, что установление флагов SYN и FIN одновременно, вроде бы, не имеет смысла, фактическая возможность установить
	оба флага есть. Есть возможность установить и все четыре флага, хотя обычно используется только один.

	>Что читала:
	http://ccfit.nsu.ru/~tischenko/stevens_1/glava18.html

1. `ss -ula sport = :53` на хосте имеет следующий вывод:

```bash
State           Recv-Q          Send-Q                   Local Address:Port                     Peer Address:Port          Process
UNCONN          0               0                        127.0.0.53%lo:domain                        0.0.0.0:*
```

Почему в `State` присутствует только `UNCONN`, и может ли там присутствовать, например, `TIME-WAIT`?

> Команда `ss -ula sport = :53` обазначает "показывать только слушащие сокеты UDP, ожидающие подключений, по номеру порта 53". `UNCONN` - отключено. В выводе данной команды не может присутствовать TIME-WAIT, так как через опцию -l выводятся только слушающие сокеты.

> Для того, чтобы увидеть все сокеты, которые находятся в режиме `TIME-WAIT` можно ввести команду `ss state time-wait`.

7. Обладая знаниями о том, как штатным образом завершается соединение (FIN от инициатора, FIN-ACK от ответчика, ACK от инициатора), опишите в каких состояниях будет находиться TCP соединение в каждый момент времени на клиенте и на сервере при завершении. Схема переходов состояния соединения вам в этом поможет.

	> Клиент и сервер находились в состоянии `ESTAB` и клиент отправляет `FIN` серверу, и после этого клиент находится в состоянии `FIN WAIT`, ожидая `ACK` от сервера.  После отправки `ACK` сервер переходит в статус `CLOSE WAIT`. После получения `ACK` от сервера клиент переходит в состояние `FIN WAIT2`
	Соединение со стороны клиента закрыто, клиент больше не может отправлять данные на сервер. Когда сервер будет готов закрыть соединение со своей стороны, он отправляет `FIN` клиенту и переходит в остояние `LAST ACK`. Клиент получает `FIN` от сервера и здесь же отправляет на сервер `ACK`. Клиент теперь находится в состоянии `TIME WAIT`, а сервер в состоянии `CLOSED`.После этого клиент переходит в состояние `CLOSED`.

1. TCP порт – 16 битное число. Предположим, 2 находящихся в одной сети хоста устанавливают между собой соединения. Каким будет теоретическое максимальное число соединений, ограниченное только лишь параметрами L4, которое параллельно может установить клиент с одного IP адреса к серверу с одним IP адресом? Сколько соединений сможет обслужить сервер от одного клиента? А если клиентов больше одного?

	>На уровне TCP, кортеж должен быть уникальным для каждого одновременного соединения. Это означает, что теоретически один клиент не может открыть более 65535 одновременных подключений к серверу (так как всего 65535 портов). 
	Сервер может (теоретически) обслуживать 65535 одновременных подключений на одного клиента.
	Если клиентов больше одного, то теоретическое максимальное число соединений может быть равно числу клиентских IP адресов * число портов на клиенте (65535).

1. Может ли сложиться ситуация, при которой большое число соединений TCP на хосте находятся в состоянии  `TIME-WAIT`? Если да, то является ли она хорошей или плохой? Подкрепите свой ответ пояснением той или иной оценки.

	>Активная сторона отправляет последний пакет в сессии (ACK на пассивный FIN). Поскольку она не может узнать получен ли этот пакет, для неё предусмотрен статус TIME_WAIT. На практике, в настоящее время, таймер TIME_WAIT устанавливается в 1 — 2 минуты. По истечению этого времени соединение считается закрытым.

	> Ситуация когда большое число соединений TCP на хосте находятся в состоянии  `TIME-WAIT` является плохой только втом члучае, если соединения от одного и того же клиента к одному и тому же серверу устанавливаются быстрее чем порты выходят из состояния `TIME-WAIT`. При очередной попытке соединения клиент может получить ошибку, соединение просто не установится. Также очередь `TIME_WAIT растет`, забирая системные ресурсы.

1. Чем особенно плоха фрагментация UDP относительно фрагментации TCP?

	>Если один фрагмент потерялся, датаграмма должна быть целиком повторно передана. TCP осуществляет тайм-аут и повторную передачу, UDP - нет. Когда потерялся фрагмент из TCP сегмента, TCP отработает тайм-аут и повторно передаст TCP сегмент целиком (IP датаграмма).

1. Если бы вы строили систему удаленного сбора логов, то есть систему, в которой несколько хостов отправяют на центральный узел генерируемые приложениями логи (предположим, что логи – текстовая информация), какой протокол транспортного уровня вы выбрали бы и почему? Проверьте ваше предположение самостоятельно, узнав о стандартном протоколе syslog.

	> Использовала бы TCP-протокол для гарантированной доставки пакетов данных. Стандартным протоколом syslogявляется UDP.

1. Сколько портов TCP находится в состоянии прослушивания на вашей виртуальной машине с Ubuntu, и каким процессам они принадлежат?

		ss -tlp
	> В состоянии прослушивания нахоятся 5 портов. Процессы не указаны.
1. Какой ключ нужно добавить в `tcpdump`, чтобы он начал выводить не только заголовки, но и содержимое фреймов в текстовом виде? А в текстовом и шестнадцатиричном?


		tcpdump -w data.pcap
		tcpdump -r
		tcpdump -x


1. Попробуйте собрать дамп трафика с помощью `tcpdump` на основном интерфейсе вашей виртуальной машины и посмотреть его через tshark или Wireshark (можно ограничить число пакетов `-c 100`). Встретились ли вам какие-то установленные флаги Internet Protocol (не флаги TCP, а флаги IP)? Узнайте, какие флаги бывают. Как на самом деле называется стандарт Ethernet, фреймы которого попали в ваш дамп? Можно ли где-то в дампе увидеть OUI?

	> Флаги IP не встретились.

	> Бывают такие флаги: Reserved, Nonce, Congestion Window Reduced (CWR), ECN-Echo, Urgent, Acknowledgment, Push, Reset, Syn, Fin

	>  Стандарт - Ethernet-II
	
	> OUI увидеть можно:

	![OUI](https://github.com/lenazve1996/imagesforreadme/blob/main/OUI.png)
